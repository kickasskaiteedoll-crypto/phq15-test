<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€ç®¡å¤–ç§‘èº«å¿ƒå¥åº·è¯„ä¼°ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/bmob.js-sdk-v4@4.0.0/dist/Bmob-4.0.0.min.js"></script>
    <style>
        :root {
            --primary-color: #0056b3; /* åŒ»ç–—æ·±è“ */
            --accent-color: #00a8e8;  /* äº®è“è£…é¥° */
            --bg-color: #f0f4f8;
            --card-shadow: 0 8px 20px rgba(0,0,0,0.06);
        }
        
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: #333; line-height: 1.6; }
        
        /* é¡¶éƒ¨ Banner */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,86,179,0.3);
        }
        .header h1 { margin: 0; font-size: 24px; font-weight: 700; }
        .header p { margin-top: 10px; opacity: 0.9; font-size: 14px; }

        .container { max-width: 600px; margin: -20px auto 30px auto; padding: 0 15px; position: relative; z-index: 10; }
        
        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: var(--card-shadow); border-top: 4px solid transparent; }
        .card-title { font-size: 18px; font-weight: bold; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; }
        .card-title::before { content: ''; display: inline-block; width: 4px; height: 18px; background-color: var(--primary-color); margin-right: 10px; border-radius: 2px; }

        /* è¡¨å•æ ·å¼ */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px; color: #555; }
        .sub-label { font-size: 12px; color: #888; margin-bottom: 8px; font-weight: normal; }
        
        input[type="text"], input[type="number"], input[type="tel"], select {
            width: 100%; padding: 12px; border: 1px solid #e1e4e8; border-radius: 8px;
            box-sizing: border-box; font-size: 16px; transition: border 0.3s; background: #fafafa;
        }
        input:focus { border-color: var(--accent-color); background: white; outline: none; }

        /* é€‰é¡¹æ ·å¼ */
        .radio-group-vertical { display: flex; flex-direction: column; gap: 10px; }
        .radio-option {
            display: flex; align-items: center; padding: 10px 15px; 
            border: 1px solid #eee; border-radius: 8px; cursor: pointer; transition: all 0.2s;
        }
        .radio-option:hover { background-color: #f8fbff; }
        .radio-option input { margin-right: 12px; transform: scale(1.2); }

        /* PHQ-15 é¢˜ç›®æ ·å¼ */
        .phq-item { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px dashed #eee; }
        .phq-item:last-child { border-bottom: none; }
        .phq-text { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .phq-desc { font-size: 13px; color: #7f8c8d; margin-bottom: 12px; }
        
        .phq-options { display: flex; gap: 8px; }
        .phq-btn {
            flex: 1; text-align: center; padding: 10px 2px; border: 1px solid #e0e0e0;
            border-radius: 6px; font-size: 13px; cursor: pointer; background: white; color: #666;
        }
        /* é€‰ä¸­çŠ¶æ€é€»è¾‘ç”±JSæ§åˆ¶class */
        .phq-btn.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); font-weight: bold; }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            width: 100%; background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white; padding: 16px; border: none; border-radius: 30px; font-size: 18px; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0, 86, 179, 0.3); margin-top: 10px;
        }
        .submit-btn:disabled { background: #ccc; box-shadow: none; }

        /* ç»“æœé¡µ */
        #result-section { display: none; text-align: center; padding-top: 40px; }
        .score-circle {
            width: 120px; height: 120px; background: white; border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            margin: 0 auto 20px; border: 6px solid var(--primary-color); box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .score-num { font-size: 42px; font-weight: bold; color: var(--primary-color); line-height: 1; }
        .score-label { font-size: 12px; color: #999; margin-top: 5px; }
        .result-box { text-align: left; background: white; padding: 20px; border-radius: 12px; margin-top: 20px; }
        
        .badge { display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 12px; margin-bottom: 5px; background: #eef2f7; color: #555; }
    </style>
</head>
<body>

<div class="header">
    <h1>èº«å¿ƒå¥åº·ç»¼åˆè¯„ä¼°</h1>
    <p>è¡€ç®¡å¤–ç§‘ Â· è¾…åŠ©è¯Šç–—ç³»ç»Ÿ</p>
</div>

<div class="container" id="main-form">
    
    <div class="card" style="border-top-color: #3498db;">
        <div class="card-title">1. åŸºæœ¬ä¿¡æ¯</div>
        <div class="form-group">
            <label>å§“å <span style="color:red">*</span></label>
            <input type="text" id="username" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
        </div>
        <div class="form-group" style="display: flex; gap: 15px;">
            <div style="flex:1">
                <label>å¹´é¾„</label>
                <input type="number" id="age" placeholder="å²">
            </div>
            <div style="flex:1">
                <label>æ€§åˆ«</label>
                <select id="gender">
                    <option value="male">ç”·</option>
                    <option value="female">å¥³</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>è”ç³»ç”µè¯ <span style="color:red">*</span></label>
            <div class="sub-label">ä»…ç”¨äºåŒ»ç”Ÿå›è®¿ï¼Œæˆ‘ä»¬å°†ä¸¥æ ¼ä¿å¯†</div>
            <input type="tel" id="contact" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
        </div>
    </div>

    <div class="card" style="border-top-color: #e67e22;">
        <div class="card-title">2. ä¸“ç§‘ç—…å²ç­›æŸ¥</div>
        
        <div class="form-group">
            <label>Q1. æ‚¨ç›®å‰æ˜¯å¦æœ‰æ˜ç¡®çš„â€œå››è‚¢ç–¼ç—›â€ï¼Ÿ</label>
            <div class="radio-group-vertical">
                <label class="radio-option"><input type="radio" name="vas_pain" value="æ— ç—›"> æ— æ˜æ˜¾ç–¼ç—›</label>
                <label class="radio-option"><input type="radio" name="vas_pain" value="é—´æ­‡æ€§è·›è¡Œ"> èµ°è·¯æ—¶ç—›ï¼Œä¼‘æ¯ç¼“è§£ (é—´æ­‡æ€§è·›è¡Œ)</label>
                <label class="radio-option"><input type="radio" name="vas_pain" value="é™æ¯ç—›"> ä¼‘æ¯ä¸åŠ¨æ—¶ä¹Ÿç—› (é™æ¯ç—›)</label>
                <label class="radio-option"><input type="radio" name="vas_pain" value="æ¸¸èµ°æ€§ç–¼ç—›"> å…¨èº«æ¸¸èµ°æ€§/æ€§è´¨ä¸å®šçš„ç–¼ç—›</label>
            </div>
        </div>

        <div class="form-group">
            <label>Q2. æ˜¯å¦å·²ç¡®è¯Šå™¨è´¨æ€§è¡€ç®¡ç–¾ç—…ï¼Ÿ</label>
            <div class="sub-label">å¦‚åŠ¨è„‰ç¡¬åŒ–é—­å¡ã€æ·±é™è„‰è¡€æ “ã€é™è„‰æ›²å¼ ç­‰</div>
            <select id="vas_diagnosis">
                <option value="">è¯·é€‰æ‹©...</option>
                <option value="ç¡®è¯Šé˜³æ€§">æ˜¯ï¼ŒåŒ»é™¢å·²æ˜ç¡®è¯Šæ–­</option>
                <option value="æ£€æŸ¥é˜´æ€§">å¦ï¼Œæ£€æŸ¥è¿‡ä½†æœªå‘ç°æ˜æ˜¾è¡€ç®¡ç—…å˜</option>
                <option value="æœªæ£€æŸ¥">ä¸æ¸…æ¥š / å°šæœªæ£€æŸ¥</option>
            </select>
        </div>

        <div class="form-group">
            <label>Q3. è¿‘3å¹´å†…æ˜¯å¦æœ‰é‡å¤§ç²¾ç¥åˆ›ä¼¤ï¼Ÿ</label>
            <div class="sub-label">å¦‚äº²äººç¦»ä¸–ã€é‡ç—…ã€ä¸¥é‡æ„å¤–ã€å®¶åº­å˜æ•…ç­‰</div>
            <div class="radio-group-vertical">
                <label class="radio-option"><input type="radio" name="trauma" value="æ— "> æ— </label>
                <label class="radio-option"><input type="radio" name="trauma" value="æœ‰"> æœ‰</label>
            </div>
        </div>
    </div>

    <div class="card" style="border-top-color: #2ecc71;">
        <div class="card-title">3. è¿‘4å‘¨èº«ä½“å›°æ‰°ç¨‹åº¦ (PHQ-15)</div>
        <p style="font-size:13px; color:#666; margin-bottom:20px;">è¯·è¯„ä¼°ä¸‹åˆ—é—®é¢˜å¯¹æ‚¨é€ æˆçš„**å›°æ‰°ç¨‹åº¦**ï¼š</p>
        
        <div id="phq-list"></div>
    </div>

    <button id="submit-btn" class="submit-btn" onclick="submitData()">æäº¤è¯„ä¼°</button>
    <p style="text-align: center; color: #999; font-size: 12px; margin-top: 15px;">æœ¬ç¨‹åºä»…ç”¨äºç§‘ç ”æ•°æ®é‡‡é›†è¾…åŠ©ï¼Œä¸ä½œä¸ºç»å¯¹è¯Šæ–­ä¾æ®</p>
</div>

<div class="container" id="result-section">
    <div class="card">
        <div class="score-circle">
            <div class="score-num" id="res-score">0</div>
            <div class="score-label">PHQ-15æ€»åˆ†</div>
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <span id="res-level" style="font-size: 20px; font-weight: bold; color: #333;"></span>
        </div>

        <div class="result-box" style="background: #f8fbff;">
            <p><strong>å°Šæ•¬çš„ <span id="res-name"></span>ï¼š</strong></p>
            <p id="res-interpret" style="margin-bottom: 0;">ç»“æœè§£è¯»åŠ è½½ä¸­...</p>
        </div>

        <div class="result-box" style="margin-top: 15px; border-left: 4px solid #e67e22;">
            <p style="font-size: 14px; font-weight: bold; color: #e67e22; margin: 0 0 5px 0;">ğŸ’¡ è¡€ç®¡å¤–ç§‘åŒ»ç”Ÿæç¤ºï¼š</p>
            <p style="font-size: 13px; color: #555; margin: 0;">
                è‹¥æ‚¨çš„è¡€ç®¡æ£€æŸ¥ç»“æœæ­£å¸¸ï¼ˆé˜´æ€§ï¼‰ï¼Œä½† PHQ-15 åˆ†æ•°è¾ƒé«˜ï¼ˆ>10åˆ†ï¼‰ï¼Œæ‚¨çš„ç–¼ç—›å¯èƒ½ä¸èº¯ä½“åŒ–éšœç¢æˆ–æƒ…ç»ªå‹åŠ›æœ‰å…³ï¼Œè€Œéè¡€ç®¡å µå¡åŠ é‡ã€‚å»ºè®®ç»“åˆå¿ƒç†ç–å¯¼æ²»ç–—ã€‚
            </p>
        </div>

        <button class="submit-btn" onclick="location.reload()" style="background: #95a5a6; margin-top: 30px;">å…³é—­ / ä¸‹ä¸€ä½</button>
    </div>
</div>

<script>
    // ==========================================
    // âš ï¸ è¯·å¡«å…¥ä½ çš„ Bmob å¯†é’¥
    const SECRET_KEY = "6b0b4b7f90b157fe"; 
    const API_KEY    = "2a78e07759c6b80cb36834e24de6271a";
    // ==========================================

    Bmob.initialize(SECRET_KEY, API_KEY);

    // PHQ-15 é¢˜ç›®æ•°æ®ï¼ˆå«å¢å¼ºæè¿°ï¼‰
    const phqQuestions = [
        { t: "1. èƒƒç—›æˆ–è…¹ç—›", d: "åŒ…æ‹¬èƒƒèƒ€ã€èƒƒç—‰æŒ›ã€éšç—›ç­‰" },
        { t: "2. èƒŒç—›", d: "è…°èƒŒéƒ¨é…¸ç—›ã€åƒµç¡¬" },
        { t: "3. è‚¢ä½“æˆ–å…³èŠ‚ç—›", d: "èƒ³è†Šã€è…¿ã€è†ç›–ç­‰å¤„ç–¼ç—›ï¼ˆè¯·ç»“åˆæ‚¨æ˜¯å¦æœ‰è¡€ç®¡ç—…å˜åˆ¤æ–­ï¼‰" },
        { t: "4. å¥³æ€§ç—›ç»/æœˆç»é—®é¢˜", d: "ç”·æ€§è¯·é€‰â€œæ²¡æœ‰â€" },
        { t: "5. å¤´ç—›", d: "å¤´éƒ¨èƒ€ç—›ã€ç´§ç®æ„Ÿæˆ–åå¤´ç—›" },
        { t: "6. èƒ¸ç—›", d: "èƒ¸é—·ã€èƒ¸å£ç–¼ç—›" },
        { t: "7. å¤´æ™•", d: "æ˜æ²‰æ„Ÿã€å¤©æ—‹åœ°è½¬" },
        { t: "8. æ™•å€’ (æ™•å¥)", d: "æ„è¯†æš‚æ—¶ä¸§å¤±" },
        { t: "9. å¿ƒè·³å¿«æˆ–å¿ƒæ…Œ", d: "é™æ­¢æ—¶æ„Ÿè§‰å¿ƒè·³æ˜æ˜¾æˆ–å¿ƒå¾‹ä¸é½" },
        { t: "10. å‘¼å¸æ€¥ä¿ƒ", d: "æ°”çŸ­ã€æ„Ÿè§‰å¸ä¸è¿›æ°”" },
        { t: "11. æ€§äº¤ç–¼ç—›æˆ–é—®é¢˜", d: "æ€§ç”Ÿæ´»ç›¸å…³çš„ä¸é€‚" },
        { t: "12. è‚ é“é—®é¢˜", d: "ä¾¿ç§˜ã€è…¹æ³»æˆ–å¤§ä¾¿ä¸æˆå½¢" },
        { t: "13. æ¶ˆåŒ–é—®é¢˜", d: "æ¶å¿ƒã€èƒ€æ°”ã€æ¶ˆåŒ–ä¸è‰¯" },
        { t: "14. ç–²å€¦æ„Ÿ", d: "ç²¾åŠ›ä¸è¶³ã€æµ‘èº«æ²¡åŠ²" },
        { t: "15. ç¡çœ é—®é¢˜", d: "å…¥ç¡å›°éš¾ã€æ—©é†’æˆ–ç¡å¾—è¿‡å¤š" }
    ];

    // æ¸²æŸ“é¢˜ç›®
    const listEl = document.getElementById('phq-list');
    phqQuestions.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'phq-item';
        div.innerHTML = `
            <div class="phq-text">${q.t}</div>
            <div class="phq-desc">${q.d}</div>
            <div class="phq-options" id="q_group_${i}">
                <div class="phq-btn" onclick="selectScore(${i}, 0, this)">æ²¡æœ‰ (0)</div>
                <div class="phq-btn" onclick="selectScore(${i}, 1, this)">æœ‰ä¸€äº› (1)</div>
                <div class="phq-btn" onclick="selectScore(${i}, 2, this)">å¾ˆä¸¥é‡ (2)</div>
            </div>
            <input type="hidden" id="val_${i}" value="-1">
        `;
        listEl.appendChild(div);
    });

    // é€‰ä¸­æ ·å¼å¤„ç†
    function selectScore(qIndex, score, btnElement) {
        // æ¸…é™¤è¯¥é¢˜æ‰€æœ‰æŒ‰é’®æ ·å¼
        const group = document.getElementById(`q_group_${qIndex}`);
        const btns = group.getElementsByClassName('phq-btn');
        for(let b of btns) b.classList.remove('active');
        
        // æ¿€æ´»å½“å‰æŒ‰é’®
        btnElement.classList.add('active');
        // èµ‹å€¼éšè—åŸŸ
        document.getElementById(`val_${qIndex}`).value = score;
    }

    function getRadioValue(name) {
        const radios = document.getElementsByName(name);
        for (let r of radios) { if (r.checked) return r.value; }
        return "";
    }

    function submitData() {
        // 1. æ”¶é›†åŸºçº¿æ•°æ®
        const name = document.getElementById('username').value.trim();
        const age = document.getElementById('age').value;
        const gender = document.getElementById('gender').value;
        const contact = document.getElementById('contact').value.trim();
        
        // 2. æ”¶é›†è¡€ç®¡ä¸“ç§‘æ•°æ®
        const vasPain = getRadioValue('vas_pain');
        const vasDiagnosis = document.getElementById('vas_diagnosis').value;
        const trauma = getRadioValue('trauma');

        // éªŒè¯å¿…å¡«
        if(!name || !age || !contact) { alert("è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯ï¼ˆå§“åã€å¹´é¾„ã€ç”µè¯ï¼‰"); return; }
        if(!vasPain || !vasDiagnosis || !trauma) { alert("è¯·å®Œæˆç¬¬2éƒ¨åˆ†ï¼šä¸“ç§‘ç—…å²ç­›æŸ¥"); return; }

        // 3. è®¡ç®— PHQ-15 åˆ†æ•°
        let totalScore = 0;
        let scoreDetails = [];
        for(let i=0; i<phqQuestions.length; i++) {
            const val = parseInt(document.getElementById(`val_${i}`).value);
            if(val === -1) { alert(`ç¬¬3éƒ¨åˆ†ç¬¬ ${i+1} é¢˜æœªä½œç­”`); return; }
            totalScore += val;
            scoreDetails.push(val);
        }

        // æŒ‰é’®åŠ è½½æ€
        const btn = document.getElementById('submit-btn');
        btn.innerText = "æ•°æ®ä¸Šä¼ ä¸­...";
        btn.disabled = true;

        // ç»“æœåˆ†çº§
        let level = "";
        let interpret = "";
        if (totalScore <= 4) { 
            level = "æ— æˆ–è½»å¾®"; 
            interpret = "èº¯ä½“ç—‡çŠ¶å›°æ‰°æä½ï¼Œé€šå¸¸ä¸éœ€è¦ä¸´åºŠå¹²é¢„ã€‚";
        } else if (totalScore <= 9) { 
            level = "è½»åº¦"; 
            interpret = "å­˜åœ¨è½»åº¦çš„èº¯ä½“ä¸é€‚ï¼Œå»ºè®®ä¿æŒè‰¯å¥½çš„ä½œæ¯ï¼Œè‹¥ç—‡çŠ¶æŒç»­å¯å’¨è¯¢åŒ»ç”Ÿã€‚";
        } else if (totalScore <= 14) { 
            level = "ä¸­åº¦"; 
            interpret = "å­˜åœ¨ä¸­åº¦çš„èº¯ä½“ç—‡çŠ¶å›°æ‰°ï¼Œå¯èƒ½ä¼šå½±å“æ—¥å¸¸ç”Ÿæ´»ã€‚å»ºè®®æ‚¨ä¸åŒ»ç”Ÿè®¨è®ºæ˜¯å¦éœ€è¦è¯ç‰©æˆ–å¿ƒç†å¹²é¢„ã€‚";
        } else { 
            level = "é‡åº¦"; 
            interpret = "å­˜åœ¨é‡åº¦çš„èº¯ä½“ç—‡çŠ¶å›°æ‰°ã€‚è¿™ä¸ç„¦è™‘æŠ‘éƒæƒ…ç»ªé«˜åº¦ç›¸å…³ï¼Œå¼ºçƒˆå»ºè®®è¿›è¡Œèº«å¿ƒè”åˆè¯Šç–—ã€‚";
        }

      // 4. ä¸Šä¼  Bmob
        // ä¿®æ­£ï¼šè¡¨åä¿æŒ VascularPHQï¼Œåˆ—åå»æ‰ä¸‹åˆ’çº¿ï¼Œæ”¹ç”¨é©¼å³°å‘½å
        const query = Bmob.Query('VascularPHQ'); 
        
        query.set("name", name);
        query.set("age", parseInt(age));
        query.set("gender", gender);
        query.set("contact", contact);
        
        // --- ä»¥ä¸‹æ˜¯ä¿®æ”¹äº†åˆ—åçš„åœ°æ–¹ ---
        query.set("vasPainType", vasPain);      // åŸ vas_pain_type
        query.set("vasDiagnosis", vasDiagnosis); // åŸ vas_diagnosis
        query.set("traumaHistory", trauma);      // åŸ trauma_history
        query.set("totalScore", totalScore);     // åŸ total_score
        query.set("scoreLevel", level);          // åŸ score_level
        query.set("rawScores", scoreDetails.join(",")); // åŸ raw_scores
        // ---------------------------

        query.save().then(res => {
            // æˆåŠŸå›è°ƒ
            showResultPage(name, totalScore, level, interpret);
        }).catch(err => {
            console.log(err);
            // å³ä½¿æŠ¥é”™æç¤ºï¼Œä¹Ÿåœ¨æ§åˆ¶å°æ‰“å°å…·ä½“é”™è¯¯ï¼Œæ–¹ä¾¿è°ƒè¯•
            alert("æ•°æ®ä¸Šä¼ é‡åˆ°é—®é¢˜ (Error: " + err.code + ")ã€‚è¯·æ£€æŸ¥Bmobåå°åˆ—åæ˜¯å¦å’Œä»£ç ä¸€è‡´ã€‚");
            // ä¾ç„¶æ˜¾ç¤ºç»“æœç»™æ‚£è€…çœ‹ï¼Œé¿å…å¡ä½
            showResultPage(name, totalScore, level, interpret);
        });
    }

    function showResultPage(name, score, level, interpret) {
        document.getElementById('main-form').style.display = 'none';
        document.querySelector('.header').style.display = 'none'; // éšè—å¤´éƒ¨è®©ç•Œé¢æ›´å¹²å‡€
        document.getElementById('result-section').style.display = 'block';
        
        document.getElementById('res-name').innerText = name;
        document.getElementById('res-score').innerText = score;
        document.getElementById('res-level').innerText = level;
        document.getElementById('res-interpret').innerText = interpret;
        
        // æ ¹æ®åˆ†æ•°å˜è‰²
        const circle = document.querySelector('.score-circle');
        if(score <= 4) circle.style.borderColor = "#2ecc71";
        else if(score <= 9) circle.style.borderColor = "#f1c40f";
        else if(score <= 14) circle.style.borderColor = "#e67e22";
        else circle.style.borderColor = "#e74c3c";
        
        window.scrollTo(0, 0);
    }
</script>

</body>
</html>
